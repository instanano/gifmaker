function encode64(t){for(var $,e,n,r,i,f,o,a="",_=0,c=t.length,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";_<c;)$=t.charCodeAt(_++),e=t.charCodeAt(_++),n=t.charCodeAt(_++),r=$>>2,i=(3&$)<<4|e>>4,f=(15&e)<<2|n>>6,o=63&n,isNaN(e)?f=o=64:isNaN(n)&&(o=64),a=a+u.charAt(r)+u.charAt(i)+u.charAt(f)+u.charAt(o);return a}LZWEncoder=function(){var t,$,e,n,r,i,f,o,a,_,c,u,l={},s=[],h=[],w=0,y=!1,v=0,F=0,x=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],d=[],B=l.LZWEncoder=function r(i,f,o,a){t=i,$=f,e=o,n=Math.max(2,a)},g=function t($,e){d[u++]=$,u>=254&&A(e)},p=function t($){m(5003),w=_+2,y=!0,T(_,$)},m=function t($){for(var e=0;e<$;++e)s[e]=-1},b=l.compress=function t($,e){var n,r,i,l,v,F,x;for(n=5003,y=!1,f=a=$,o=C(f),c=(_=1<<$-1)+1,w=_+2,u=0,l=P(),x=0;n<65536;n*=2)++x;x=8-x,m(F=5003),T(_,e);outer_loop:for(;-1!=(i=P());){if(n=(i<<12)+l,s[r=i<<x^l]==n){l=h[r];continue}if(s[r]>=0){v=F-r,0===r&&(v=1);do if((r-=v)<0&&(r+=F),s[r]==n){l=h[r];continue outer_loop}while(s[r]>=0)}T(l,e),l=i,w<4096?(h[r]=w++,s[r]=n):p(e)}T(l,e),T(c,e)};l.encode=function e(f){f.writeByte(n),r=t*$,i=0,b(n+1,f),f.writeByte(0)};var A=function t($){u>0&&($.writeByte(u),$.writeBytes(d,0,u),u=0)},C=function t($){return(1<<$)-1},P=function t(){return 0===r?-1:(--r,255&e[i++])},T=function t($,e){for(v&=x[F],F>0?v|=$<<F:v=$,F+=f;F>=8;)g(255&v,e),v>>=8,F-=8;if((w>o||y)&&(y?(o=C(f=a),y=!1):o=12==++f?4096:C(f)),$==c){for(;F>0;)g(255&v,e),v>>=8,F-=8;A(e)}};return B.apply(this,arguments),l},NeuQuant=function(){var t,$,e,n,r,i={},f=64,o=65536,a=[],_=[],c=[],u=[],l=i.NeuQuant=function t(i,f,o){var a,u;for(a=0,$=i,e=f,n=o,r=Array(256);a<256;a++)r[a]=[,,,,],(u=r[a])[0]=u[1]=u[2]=(a<<12)/256,c[a]=256,_[a]=0},s=function t(){for(var $=[],e=Array(256),n=0;n<256;n++)e[r[n][3]]=n;for(var i=0,f=0;f<256;f++){var o=e[f];$[i++]=r[o][0],$[i++]=r[o][1],$[i++]=r[o][2]}return $},h=function t(){var $,e,n,i,f,o,_,c;for($=0,_=0,c=0;$<256;$++){for(f=r[$],n=$,i=f[1],e=$+1;e<256;e++)(o=r[e])[1]<i&&(n=e,i=o[1]);if(o=r[n],$!=n&&(e=o[0],o[0]=f[0],f[0]=e,e=o[1],o[1]=f[1],f[1]=e,e=o[2],o[2]=f[2],f[2]=e,e=o[3],o[3]=f[3],f[3]=e),i!=_){for(a[_]=c+$>>1,e=_+1;e<i;e++)a[e]=$;_=i,c=$}}for(a[_]=c+255>>1,e=_+1;e<256;e++)a[e]=255},w=function r(){var i,f,o,a,_,c,l,s,h,w,y,d,B,g;for(e<1509&&(n=1),t=30+(n-1)/3,d=$,B=0,g=e,w=(y=e/(3*n))/100|0,s=1024,(l=(c=2048)>>6)<=1&&(l=0),i=0;i<l;i++)u[i]=s*((l*l-i*i)*256/(l*l));for(h=e<1509?3:e%499!=0?1497:e%491!=0?1473:e%487!=0?1461:1509,i=0;i<y;)if(o=(255&d[B+0])<<4,f=x(o,a=(255&d[B+1])<<4,_=(255&d[B+2])<<4),F(s,f,o,a,_),0!==l&&v(l,f,o,a,_),(B+=h)>=g&&(B-=e),0===w&&(w=1),++i%w==0)for(s-=s/t,c-=c/30,l=c>>6,l<=1&&(l=0),f=0;f<l;f++)u[f]=s*((l*l-f*f)*256/(l*l))};i.map=function t($,e,n){var i,f,o,_,c,u,l;for(c=1e3,l=-1,f=(i=a[e])-1;i<256||f>=0;)i<256&&((o=(u=r[i])[1]-e)>=c?i=256:(i++,o<0&&(o=-o),(_=u[0]-$)<0&&(_=-_),(o+=_)<c&&((_=u[2]-n)<0&&(_=-_),(o+=_)<c&&(c=o,l=u[3])))),f>=0&&((o=e-(u=r[f])[1])>=c?f=-1:(f--,o<0&&(o=-o),(_=u[0]-$)<0&&(_=-_),(o+=_)<c&&((_=u[2]-n)<0&&(_=-_),(o+=_)<c&&(c=o,l=u[3]))));return l},i.process=function t(){return w(),y(),h(),s()};var y=function t(){var $;for($=0;$<256;$++)r[$][0]>>=4,r[$][1]>>=4,r[$][2]>>=4,r[$][3]=$},v=function t($,e,n,i,f){var o,a,_,c,l,s,h;for((_=e-$)<-1&&(_=-1),(c=e+$)>256&&(c=256),o=e+1,a=e-1,s=1;o<c||a>_;){if(l=u[s++],o<c){h=r[o++];try{h[0]-=l*(h[0]-n)/262144,h[1]-=l*(h[1]-i)/262144,h[2]-=l*(h[2]-f)/262144}catch(w){}}if(a>_){h=r[a--];try{h[0]-=l*(h[0]-n)/262144,h[1]-=l*(h[1]-i)/262144,h[2]-=l*(h[2]-f)/262144}catch(y){}}}},F=function t($,e,n,i,f){var o=r[e];o[0]-=$*(o[0]-n)/1024,o[1]-=$*(o[1]-i)/1024,o[2]-=$*(o[2]-f)/1024},x=function t($,e,n){var i,a,u,l,s,h,w,y,v,F;for(i=0,v=y=2147483647,w=h=-1;i<256;i++)(a=(F=r[i])[0]-$)<0&&(a=-a),(u=F[1]-e)<0&&(u=-u),a+=u,(u=F[2]-n)<0&&(u=-u),(a+=u)<y&&(y=a,h=i),(l=a-(_[i]>>12))<v&&(v=l,w=i),s=c[i]>>10,c[i]-=s,_[i]+=s<<10;return c[h]+=f,_[h]-=o,w};return l.apply(this,arguments),i},GIFEncoder=function(){for(var t,$,e,n,r,i,f,o,a,_=0,c={};_<256;_++)c[_]=String.fromCharCode(_);function u(){this.bin=[]}u.prototype.getData=function(){for(var t="",$=this.bin.length,e=0;e<$;e++)t+=c[this.bin[e]];return t},u.prototype.writeByte=function(t){this.bin.push(t)},u.prototype.writeUTFBytes=function(t){for(var $=t.length,e=0;e<$;e++)this.writeByte(t.charCodeAt(e))},u.prototype.writeBytes=function(t,$,e){for(var n=e||t.length,r=$||0;r<n;r++)this.writeByte(t[r])};var l={},s=null,h=-1,w=0,y=!1,v=[],F=7,x=-1,d=!1,B=!0,g=!1,p=10,m="Generated by jsgif (https://github.com/antimatter15/jsgif/)";l.setDelay=function t($){w=Math.round($/10)},l.setDispose=function t($){$>=0&&(x=$)},l.setRepeat=function t($){$>=0&&(h=$)},l.setTransparent=function t($){s=$},l.setComment=function t($){m=$},l.addFrame=function e(i,f){if(null===i||!y||null===n)throw Error("Please call start method before calling addFrame");var o=!0;try{f?i instanceof ImageData?(r=i.data,sizeset&&t==i.width&&$==i.height||A(i.width,i.height)):i instanceof Uint8ClampedArray?i.length==t*$*4?r=i:(console.log("Please set the correct size: ImageData length mismatch"),o=!1):(console.log("Please provide correct input"),o=!1):(r=i.getImageData(0,0,i.canvas.width,i.canvas.height).data,g||A(i.canvas.width,i.canvas.height)),T(),C(),B&&(j(),R(),h>=0&&I()),D(),""!==m&&U(),E(),B||R(),G(),B=!1}catch(a){o=!1}return o},l.download=function t($){if(null===n||!1==d)console.log("Please call start method and add frames and call finish method before calling download");else{$=void 0!==$?$.endsWith(".gif")?$:$+".gif":"download.gif";var e=document.createElement("a");e.download=$,e.href=URL.createObjectURL(new Blob([new Uint8Array(n.bin)],{type:"image/gif"})),e.click()}},l.finish=function t(){if(!y)return!1;var $=!0;y=!1;try{n.writeByte(59),d=!0}catch(e){$=!1}return $};var b=function t(){e=0,r=null,i=null,f=null,a=null,d=!1,B=!0};l.setFrameRate=function t($){15!=$&&(w=Math.round(100/$))},l.setQuality=function t($){$<1&&($=1),p=$};var A=l.setSize=function e(n,r){(!y||B)&&((t=n)<1&&(t=320),($=r)<1&&($=240),g=!0)};l.start=function t(){b();var $=!0;d=!1,n=new u;try{n.writeUTFBytes("GIF89a")}catch(e){$=!1}return y=$},l.cont=function t(){return b(),d=!1,n=new u,y=!0};var C=function t(){var $=i.length,n=$/3;f=[];var r=new NeuQuant(i,$,p);a=r.process();for(var _=0,c=0;c<n;c++){var u=r.map(255&i[_++],255&i[_++],255&i[_++]);v[u]=!0,f[c]=u}i=null,o=8,F=7,null!==s&&(e=P(s))},P=function t($){if(null===a)return -1;for(var e=(16711680&$)>>16,n=(65280&$)>>8,r=255&$,i=0,f=16777216,o=a.length,_=0;_<o;){var c=e-(255&a[_++]),u=n-(255&a[_++]),l=r-(255&a[_]),s=c*c+u*u+l*l,h=_/3;v[h]&&s<f&&(f=s,i=h),_++}return i},T=function e(){var n=t,f=$;i=[];for(var o=r,a=0,_=0;_<f;_++)for(var c=0;c<n;c++){var u=_*n*4+4*c;i[a++]=o[u],i[a++]=o[u+1],i[a++]=o[u+2]}},D=function t(){var $,r;n.writeByte(33),n.writeByte(249),n.writeByte(4),null===s?($=0,r=0):($=1,r=2),x>=0&&(r=7&x),r<<=2,n.writeByte(0|r|0|$),z(w),n.writeByte(e),n.writeByte(0)},U=function t(){n.writeByte(33),n.writeByte(254),n.writeByte(m.length),n.writeUTFBytes(m),n.writeByte(0)},E=function e(){n.writeByte(44),z(0),z(0),z(t),z($),B?n.writeByte(0):n.writeByte(128|F)},j=function e(){z(t),z($),n.writeByte(240|F),n.writeByte(0),n.writeByte(0)},I=function t(){n.writeByte(33),n.writeByte(255),n.writeByte(11),n.writeUTFBytes("NETSCAPE2.0"),n.writeByte(3),n.writeByte(1),z(h),n.writeByte(0)},R=function t(){n.writeBytes(a);for(var $=768-a.length,e=0;e<$;e++)n.writeByte(0)},z=function t($){n.writeByte(255&$),n.writeByte($>>8&255)},G=function e(){new LZWEncoder(t,$,f,o).encode(n)};return l.stream=function t(){return n},l.setProperties=function t($,e){y=$,B=e},l};
